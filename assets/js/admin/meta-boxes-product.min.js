jQuery(function(e){function t(){var t=e("select#product-type").val(),i=e("input#_virtual:checked").length,a=e("input#_downloadable:checked").length,o=".hide_if_downloadable, .hide_if_virtual",c=".show_if_downloadable, .show_if_virtual";e.each(woocommerce_admin_meta_boxes.product_types,function(e,t){o=o+", .hide_if_"+t,c=c+", .show_if_"+t}),e(o).show(),e(c).hide(),a&&e(".show_if_downloadable").show(),i&&e(".show_if_virtual").show(),e(".show_if_"+t).show(),a&&e(".hide_if_downloadable").hide(),i&&e(".hide_if_virtual").hide(),e(".hide_if_"+t).hide(),e("input#_manage_stock").change(),e(".woocommerce_options_panel").each(function(){var t=e(this).children(".options_group");if(0!==t.length&&t.filter(function(){return"none"===e(this).css("display")}).length===t.length){var i=e(this).prop("id");e(".product_data_tabs").find('li a[href="#'+i+'"]').parent().hide()}})}function i(t){var i=e(t).next().is(".hasDatepicker")?"minDate":"maxDate",a="minDate"===i?e(t).next():e(t).prev(),o=e(t).datepicker("getDate");e(a).datepicker("option",i,o),e(t).change()}function a(){e(".product_attributes .woocommerce_attribute").each(function(t,i){e(".attribute_position",i).val(parseInt(e(i).index(".product_attributes .woocommerce_attribute"),10))})}function o(t,i){var a=[],o=u.find(".image").map(function(){return parseInt(e(this).data("attachment_id"),10)}).get();i&&(a=o.slice(0)),t.state().get("selection").map(function(t){if((t=t.toJSON()).id){var i=parseInt(t.id,10);if(a.push(i),-1===e.inArray(i,o)){var c=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;u.append('<li class="image" data-attachment_id="'+i+'"><a href="#" class="edit-attachment"><img src="'+c+'" /></a><ul class="actions"><li><a href="#" class="delete" title="'+woocommerce_admin_product_meta_boxes.i18n_delete_image+'">'+woocommerce_admin_product_meta_boxes.i18n_delete_image+"</a></li></ul></li>")}}}),i||o.map(function(t){-1===e.inArray(t,a)&&u.find("li.image[data-attachment_id="+t+"]").remove()}),e("#product_image_gallery").val(a.join()),u.append(u.find(".add_product_images"))}e(".woocommerce-edit-product-field__sale_price input").on("input",function(){e(this).val()?e(".woocommerce-edit-product-field__regular_price").addClass("has-sale-price"):e(".woocommerce-edit-product-field__regular_price").removeClass("has-sale-price")}).trigger("input"),e(function(){e('[id$="-all"] > ul.categorychecklist').each(function(){var t=e(this),i=t.find(":checked").first();if(i.length){var a=t.find("input").position().top,o=i.position().top;t.closest(".tabs-panel").scrollTop(o-a+5)}})}),e("#upsell_product_data").bind("keypress",function(e){if(13===e.keyCode)return!1}),e(".type_box").appendTo("#woocommerce-product-data .hndle span"),e(function(){e("#woocommerce-product-data").find(".hndle").unbind("click.postboxes"),e("#woocommerce-product-data").on("click",".hndle",function(t){e(t.target).filter("input, option, label, select").length||e("#woocommerce-product-data").toggleClass("closed")})}),e("#catalog-visibility").find(".edit-catalog-visibility").click(function(){return e("#catalog-visibility-select").is(":hidden")&&(e("#catalog-visibility-select").slideDown("fast"),e(this).hide()),!1}),e("#catalog-visibility").find(".save-post-visibility").click(function(){e("#catalog-visibility-select").slideUp("fast"),e("#catalog-visibility").find(".edit-catalog-visibility").show();var t=e("input[name=_visibility]:checked").attr("data-label");return e("input[name=_featured]").is(":checked")&&(t=t+", "+woocommerce_admin_meta_boxes.featured_label,e("input[name=_featured]").attr("checked","checked")),e("#catalog-visibility-display").text(t),!1}),e("#catalog-visibility").find(".cancel-post-visibility").click(function(){e("#catalog-visibility-select").slideUp("fast"),e("#catalog-visibility").find(".edit-catalog-visibility").show();var t=e("#current_visibility").val(),i=e("#current_featured").val();e("input[name=_visibility]").removeAttr("checked"),e("input[name=_visibility][value="+t+"]").attr("checked","checked");var a=e("input[name=_visibility]:checked").attr("data-label");return"yes"===i?(a=a+", "+woocommerce_admin_meta_boxes.featured_label,e("input[name=_featured]").attr("checked","checked")):e("input[name=_featured]").removeAttr("checked"),e("#catalog-visibility-display").text(a),!1}),e("select#product-type").change(function(){var i=e(this).val();"variable"===i?(e("input#_manage_stock").change(),e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")):"grouped"===i?(e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")):"external"===i&&(e("input#_downloadable").prop("checked",!1),e("input#_virtual").removeAttr("checked")),t(),e("ul.wc-tabs li:visible").eq(0).find("a").click(),e(document.body).trigger("woocommerce-product-type-change",i,e(this))}).change(),e("input#_downloadable, input#_virtual").change(function(){t()}),e(".sale_price_dates_fields").each(function(){var t=e(this),i=!1,a=t.closest("div, table");t.find("input").each(function(){""!==e(this).val()&&(i=!0)}),i?(a.find(".sale_schedule").hide(),a.find(".sale_price_dates_fields").show()):(a.find(".sale_schedule").show(),a.find(".sale_price_dates_fields").hide())}),e("#woocommerce-product-data").on("click",".sale_schedule",function(){var t=e(this).closest("div, table");return e(this).hide(),t.find(".cancel_sale_schedule").show(),t.find(".sale_price_dates_fields").show(),!1}),e("#woocommerce-product-data").on("click",".cancel_sale_schedule",function(){var t=e(this).closest("div, table");return e(this).hide(),t.find(".sale_schedule").show(),t.find(".sale_price_dates_fields").hide(),t.find(".sale_price_dates_fields").find("input").val(""),!1}),e("#woocommerce-product-data").on("click",".downloadable_files a.insert",function(){return e(this).closest(".downloadable_files").find("tbody").append(e(this).data("row")),!1}),e("#woocommerce-product-data").on("click",".downloadable_files a.delete",function(){return e(this).closest("tr").remove(),!1}),e("input#_manage_stock").change(function(){e(this).is(":checked")?e("div.stock_fields").show():e("div.stock_fields").hide()}).change(),e(".sale_price_dates_fields").each(function(){e(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){i(e(this))}}),e(this).find("input").each(function(){i(e(this))})});var c=e(".product_attributes").find(".woocommerce_attribute").get();c.sort(function(t,i){var a=parseInt(e(t).attr("rel"),10),o=parseInt(e(i).attr("rel"),10);return a<o?-1:a>o?1:0}),e(c).each(function(t,i){e(".product_attributes").append(i)}),e(".product_attributes .woocommerce_attribute").each(function(t,i){"none"!==e(i).css("display")&&e(i).is(".taxonomy")&&e("select.attribute_taxonomy").find('option[value="'+e(i).data("taxonomy")+'"]').attr("disabled","disabled")}),e("button.add_attribute").on("click",function(){var t=e(".product_attributes .woocommerce_attribute").length,i=e("select.attribute_taxonomy").val(),o=e(this).closest("#product_attributes"),c=o.find(".product_attributes"),n=e("select#product-type").val(),r={action:"woocommerce_add_attribute",taxonomy:i,i:t,security:woocommerce_admin_meta_boxes.add_attribute_nonce};return o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.post(woocommerce_admin_meta_boxes.ajax_url,r,function(t){c.append(t),"variable"!==n&&c.find(".enable_variation").hide(),e(document.body).trigger("wc-enhanced-select-init"),a(),o.unblock(),e(document.body).trigger("woocommerce_added_attribute")}),i&&(e("select.attribute_taxonomy").find('option[value="'+i+'"]').attr("disabled","disabled"),e("select.attribute_taxonomy").val("")),!1}),e(".product_attributes").on("blur","input.attribute_name",function(){e(this).closest(".woocommerce_attribute").find("strong.attribute_name").text(e(this).val())}),e(".product_attributes").on("click","button.select_all_attributes",function(){return e(this).closest("td").find("select option").attr("selected","selected"),e(this).closest("td").find("select").change(),!1}),e(".product_attributes").on("click","button.select_no_attributes",function(){return e(this).closest("td").find("select option").removeAttr("selected"),e(this).closest("td").find("select").change(),!1}),e(".product_attributes").on("click",".remove_row",function(){if(window.confirm(woocommerce_admin_meta_boxes.remove_attribute)){var t=e(this).parent().parent();t.is(".taxonomy")?(t.find("select, input[type=text]").val(""),t.hide(),e("select.attribute_taxonomy").find('option[value="'+t.data("taxonomy")+'"]').removeAttr("disabled")):(t.find("select, input[type=text]").val(""),t.hide(),a())}return!1}),e(".product_attributes").sortable({items:".woocommerce_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),a()}}),e(".product_attributes").on("click","button.add_new_attribute",function(){e(".product_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t=e(this).closest(".woocommerce_attribute"),i=t.data("taxonomy"),a=window.prompt(woocommerce_admin_meta_boxes.new_attribute_prompt);if(a){var o={action:"woocommerce_add_new_attribute",taxonomy:i,term:a,security:woocommerce_admin_meta_boxes.add_attribute_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(i){i.error?window.alert(i.error):i.slug&&(t.find("select.attribute_values").append('<option value="'+i.term_id+'" selected="selected">'+i.name+"</option>"),t.find("select.attribute_values").change()),e(".product_attributes").unblock()})}else e(".product_attributes").unblock();return!1}),e(".save_attributes").on("click",function(){e("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t={post_id:woocommerce_admin_meta_boxes.post_id,product_type:e("#product-type").val(),data:e(".product_attributes").find("input, select, textarea").serialize(),action:"woocommerce_save_attributes",security:woocommerce_admin_meta_boxes.save_attributes_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(){var t=window.location.toString();t=t.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),e("#variable_product_options").load(t+" #variable_product_options_inner",function(){e("#variable_product_options").trigger("reload")})})});var n,r;e(document.body).on("click",".upload_file_button",function(t){var i=e(this);if(r=i.closest("tr").find("td.file_url input"),t.preventDefault(),n)n.open();else{var a=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:i.data("choose"),priority:20,filterable:"uploaded"})];(n=wp.media.frames.downloadable_file=wp.media({title:i.data("choose"),library:{type:""},button:{text:i.data("update")},multiple:!0,states:a})).on("select",function(){var e="";n.state().get("selection").map(function(t){(t=t.toJSON()).url&&(e=t.url)}),r.val(e).change()}),n.on("ready",function(){n.uploader.options.uploader.params={type:"downloadable_product"}}),n.open()}}),e(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65});var l,d,s,u=e("#product_images_container").find("ul.product_images");e(".add_product_images").on("click","a",function(t){var i=e(this);t.preventDefault(),l?l.open():((l=wp.media.frames.product_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){o(l,!0)}),l.open())}),u.on("click",".edit-attachment",function(t){t.preventDefault(),t.stopPropagation(),(s=u.find(".image").map(function(){return e(this).data("attachment_id")}).get()).unshift(e(this).closest("li.image").data("attachment_id")),d?d.open():((d=wp.media.frames.product_gallery=wp.media({title:woocommerce_admin_product_meta_boxes.i18n_select_images,button:{text:woocommerce_admin_product_meta_boxes.i18n_update_gallery},states:[new wp.media.controller.Library({title:woocommerce_admin_product_meta_boxes.i18n_select_images,filterable:"all",multiple:!0})]})).on("select",function(){o(d,!1)}),d.on("open",function(){var e=d.state().get("selection");e.reset(),s.forEach(function(t){var i=wp.media.attachment(t);i.fetch(),e.add(i?[i]:[])})}),d.open())}),u.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),e("#product_image_gallery").val(t)}}),e("#product_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";return e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),e("#product_image_gallery").val(t),e("#tiptip_holder, #tiptip_arrow").removeAttr("style"),!1})});